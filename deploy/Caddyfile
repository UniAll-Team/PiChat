{
	debug
	storage file_system {
		root /var/lib/caddy
	}

	log {
		output file /var/log/caddy/caddy.jsonl {
			roll_size 10M
			roll_keep 5
			roll_keep_for 7d
		}
		# 即使是用 console 格式输出，内容也是 json 格式，所以还不如直接输出 json
		format json {
			time_format iso8601
		}
		level DEBUG
	}
}

{$CADDY_DOMAIN} {
	reverse_proxy /abbasid/* unix//dev/shm/xrxh.socket {
		# flush_interval -1
		transport http {
			versions h2c
		}
	}

	reverse_proxy :3000

	log {
		output file /var/log/caddy/{$NUXT_SITE_NAME}.jsonl {
			roll_size 10M
			roll_keep 5
			roll_keep_for 7d
		}
		# 即使是用 console 格式输出，内容也是 json 格式，所以还不如直接输出 json
		format json {
			time_format iso8601
		}
		level DEBUG
	}
}
